# models: 
# gpt-neo-20b
# fairseq-13b
# gpt-3.5-turbo

!require-input>model

!format
got: {model}
!print

# load the JSON
!literal
https://raw.githubusercontent.com/google/BIG-bench/main/bigbench/benchmark_tasks/irony_identification/task.json
!fetch-url
!json-parse examples=examples

!format>statement
{input}

!columns statement ironic=target_scores_ironic
!ravel

!take 10

# TODO: input non-last column?
!format>zero-shot
You will be given a number of statements and determine if they are ironic. If the statement is ironic, respond with 1, otherwise respond with 0. Do not respond with anything except a single digit.

!format
{zero-shot}
Statement: {statement}
Score: 
!llm>score_zero_shot model={model} max_tokens=1

!format
{zero-shot}
Statement: Queen Cersei Lannister was smiling. This terrified her courtiers.
Score: 1
Statement: It’s okay if you don’t like me. Not everyone has similar preferences in the type of people they are partial to.
Score: 0
Statement: {statement}
Score: 
!llm>score_two_shot model=fairseq-13b max_tokens=1

# load ground truth and calculate accuracy matrix

# TODO: reformat into direct comparison
# !format
# {examples} 
# {scores_gpt35} {score_fs13b} {scores}
# Exception: AIPL Error (line 33 !format): 'examples'

# TODO: calculate matrix (models x N-shot)
!format
{score_zero_shot} {score_two_shot} ({ironic}): {statement}
!print
# !columns score_zero_shot score_two_shot ironic statement model
!json
!save {model}-irony-detection.json
